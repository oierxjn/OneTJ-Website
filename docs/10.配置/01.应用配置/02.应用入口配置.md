---
title: 应用入口配置
date: 2025-01-29 00:00:00
permalink: /reference/config/app-entry
categories:
  - 配置
tags:
  - 配置
  - 入口
description: 介绍 OneTJ 应用的入口配置。
---

## main.dart 概述

`lib/main.dart` 是 OneTJ 应用的入口文件，负责初始化应用并配置全局设置。

## 完整代码

```dart
import 'package:flutter/material.dart';
import 'package:flutter_localizations/flutter_localizations.dart';
import 'package:flutter_gen/gen_l10n/app_localizations.dart';
import 'package:onetj/app/router/app_router.dart';

void main() {
  WidgetsFlutterBinding.ensureInitialized();
  runApp(const OneTJApp());
}

class OneTJApp extends StatelessWidget {
  const OneTJApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp.router(
      localizationsDelegates: const [
        AppLocalizations.delegate,
        GlobalMaterialLocalizations.delegate,
        GlobalWidgetsLocalizations.delegate,
        GlobalCupertinoLocalizations.delegate,
      ],
      supportedLocales: const [
        Locale('zh', 'CN'),
        Locale('en'),
      ],
      onGenerateTitle: (context) => AppLocalizations.of(context).appTitle,
      theme: ThemeData(
        colorScheme: ColorScheme.fromSeed(
          seedColor: const Color.fromARGB(125, 230, 90, 255),
        ),
        useMaterial3: true,
      ),
      routerConfig: AppRouter.router,
    );
  }
}
```

## 初始化流程

### WidgetsFlutterBinding

```dart
void main() {
  WidgetsFlutterBinding.ensureInitialized();
  runApp(const OneTJApp());
}
```

`WidgetsFlutterBinding.ensureInitialized()` 确保 Flutter 框架已完全初始化，在进行任何 Flutter 操作之前必须调用。

### runApp

```dart
runApp(const OneTJApp());
```

`runApp` 将 `OneTJApp` 组件附加到屏幕上，作为应用的根组件。

## MaterialApp.router 配置

使用 `MaterialApp.router` 配置应用，这是支持 `go_router` 的推荐方式。

### 国际化配置

```dart
localizationsDelegates: const [
  AppLocalizations.delegate,      // 应用自定义翻译
  GlobalMaterialLocalizations.delegate,   // Material 组件翻译
  GlobalWidgetsLocalizations.delegate,    // Widget 翻译
  GlobalCupertinoLocalizations.delegate,  // Cupertino 组件翻译
],
supportedLocales: const [
  Locale('zh', 'CN'),  // 简体中文
  Locale('en'),        // 英语
],
onGenerateTitle: (context) => AppLocalizations.of(context).appTitle,
```

| 配置项 | 说明 |
|--------|------|
| `localizationsDelegates` | 本地化代理列表 |
| `supportedLocales` | 支持的语言列表 |
| `onGenerateTitle` | 动态生成应用标题 |

### 主题配置

```dart
theme: ThemeData(
  colorScheme: ColorScheme.fromSeed(
    seedColor: const Color.fromARGB(125, 230, 90, 255),
  ),
  useMaterial3: true,
),
```

使用 Material Design 3 的主题系统，基于种子颜色生成完整的配色方案。

### 路由配置

```dart
routerConfig: AppRouter.router,
```

使用 `go_router` 提供的路由配置。

## 国际化资源

### ARB 文件位置

```
lib/l10n/
├── app_en.arb    # 英文翻译
└── app_zh.arb    # 中文翻译
```

### app_zh.arb 示例

```json
{
  "appTitle": "一统同济",
  "dashboard": "仪表盘",
  "timetable": "课程表",
  "settings": "设置"
}
```

### 使用翻译

```dart
// 在代码中使用
Text(AppLocalizations.of(context).dashboard)

// 或通过 BuildContext
Text(context.l10n.dashboard)
```

## 路由器配置

### AppRouter 定义

```dart
// lib/app/router/app_router.dart
class AppRouter {
  const AppRouter._();

  static final GoRouter router = GoRouter(
    routes: [
      ...launcherRoutes,
      ...loginRoutes,
      homeShellRoute,
    ],
  );
}
```

### 路由类型

| 路由 | 路径 | 说明 |
|------|------|------|
| **Launcher** | `/` | 启动页 |
| **Login** | `/login` | 登录页 |
| **Home** | `/home` | 主页容器 |
| **Dashboard** | `/dashboard` | 仪表盘 |
| **Timetable** | `/timetable` | 课程表 |
| **Settings** | `/settings` | 设置 |

## 主题定制

### 修改主题色

```dart
theme: ThemeData(
  colorScheme: ColorScheme.fromSeed(
    seedColor: const Color.fromARGB(125, 230, 90, 255),  // 修改此处
  ),
  useMaterial3: true,
),
```

### 添加暗色主题

```dart
theme: ThemeData(
  colorScheme: ColorScheme.fromSeed(
    seedColor: const Color.fromARGB(125, 230, 90, 255),
    brightness: Brightness.light,
  ),
  useMaterial3: true,
),
darkTheme: ThemeData(
  colorScheme: ColorScheme.fromSeed(
    seedColor: const Color.fromARGB(125, 230, 90, 255),
    brightness: Brightness.dark,
  ),
  useMaterial3: true,
),
themeMode: ThemeMode.system,  // 跟随系统
```

## 调试配置

### 启用调试标志

```dart
void main() {
  WidgetsFlutterBinding.ensureInitialized();

  // 启用调试标志
  debugPrintAppStarted = true;

  runApp(const OneTJApp());
}
```

### 性能叠加层

```dart
MaterialApp.router(
  // ...
  showPerformanceOverlay: kDebugMode,  // 调试模式下显示性能叠加层
)
```
