---
title: API 端点
date: 2025-01-29 00:00:00
permalink: /reference/config/api
categories:
  - 配置
tags:
  - 配置
  - API
description: 介绍 OneTJ 使用的同济大学 API 端点。
---

## API 基础信息

### 基础 URL

```
https://api.tongji.edu.cn
```

### 认证方式

所有 API 请求需要使用 `Bearer Token` 认证：

```http
Authorization: Bearer <access_token>
```

## OAuth 端点

### 授权端点

```
GET /keycloak/realms/OpenPlatform/protocol/openid-connect/auth
```

**参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `client_id` | string | 是 | 客户端 ID |
| `redirect_uri` | string | 是 | 重定向 URI |
| `response_type` | string | 是 | 固定值 `code` |
| `scope` | string | 是 | 权限范围，空格分隔 |

### 令牌端点

```
POST /v1/token
```

**请求体**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `grant_type` | string | 是 | `authorization_code` 或 `refresh_token` |
| `client_id` | string | 是 | 客户端 ID |
| `code` | string | 条件 | 授权码（授权码模式） |
| `refresh_token` | string | 条件 | 刷新令牌（刷新模式） |
| `redirect_uri` | string | 条件 | 重定向 URI（授权码模式） |

## 数据端点

### 学生信息

```
GET /v1/dc/user/student_info
```

**响应示例**：

```json
{
  "code": "0",
  "data": [
    {
      "userId": "2103759",
      "name": "张三",
      "sexCode": "1",
      "sexName": "男",
      "deptCode": "001",
      "deptName": "计算机科学与技术学院",
      "enrolDate": "2021-09-01",
      "expGraduationDate": "2025-06-30",
      "lengthSchooling": "4",
      "trainingLevelName": "本科",
      "politicalStatusName": "共青团员",
      "statusCode": "1",
      "statusName": "在校"
    }
  ]
}
```

### 当前学期校历

```
GET /v1/rt/onetongji/school_calendar_current_term_calendar
```

**响应示例**：

```json
{
  "code": "0",
  "data": {
    "simpleName": "2024-2025学年第一学期",
    "week": 5,
    "startDate": "2024-09-02",
    "endDate": "2025-01-18",
    "totalWeeks": 19
  }
}
```

### 学生课程表

```
GET /v1/rt/onetongji/student_timetable
```

**响应示例**：

```json
{
  "code": "0",
  "data": [
    {
      "courseName": "高等数学",
      "dayOfWeek": 1,
      "timeStart": 1,
      "timeEnd": 2,
      "roomId": "A101",
      "roomIdI18n": "同济大厦A座101",
      "teacherName": "李老师"
    }
  ]
}
```

### CET 成绩

```
GET /v1/rt/onetongji/cet_score
```

### 本科生成绩

```
GET /v1/rt/onetongji/undergraduate_score
```

### 体测数据

```
GET /v1/rt/teaching_info/sports_test_data
```

### 体测健康数据

```
GET /v1/rt/teaching_info/sports_test_health
```

### 全部学期校历

```
GET /v1/rt/onetongji/school_calendar_all_term_calendar
```

### 消息列表

```
GET /v1/rt/onetongji/msg_list
```

### 消息详情

```
GET /v1/rt/onetongji/msg_detail
```

## 响应格式

### 成功响应

```json
{
  "code": "0",
  "data": { ... }
}
```

### 错误响应

```json
{
  "code": "401",
  "message": "Unauthorized"
}
```

## 错误码

| 错误码 | 说明 |
|--------|------|
| `0` | 成功 |
| `401` | 未授权，Token 无效或过期 |
| `403` | 禁止访问，权限不足 |
| `404` | 资源不存在 |
| `500` | 服务器内部错误 |

## 调用示例

### 使用 Dart http 包

```dart
import 'package:http/http.dart' as http;

Future<StudentInfoData> fetchStudentInfo() async {
  final uri = Uri.https(
    'api.tongji.edu.cn',
    '/v1/dc/user/student_info',
  );

  final response = await http.get(
    uri,
    headers: {
      'Authorization': 'Bearer $accessToken',
    },
  );

  if (response.statusCode == 200) {
    return StudentInfoData.fromJson(json.decode(response.body));
  } else {
    throw Exception('Failed to load student info');
  }
}
```

### 使用 curl

```bash
curl -X GET \
  'https://api.tongji.edu.cn/v1/dc/user/student_info' \
  -H 'Authorization: Bearer YOUR_ACCESS_TOKEN'
```

## 速率限制

同济大学 API 可能存在速率限制，建议：

1. 合理使用本地缓存，减少 API 调用
2. 避免频繁重复请求相同数据
3. 处理 `429 Too Many Requests` 响应

## 配置修改

### 添加新端点

在 `lib/app/constant/site_constant.dart` 中添加：

```dart
const String newEndpointPath = "/v1/new/endpoint";
```

### 在 TongjiApi 中添加方法

```dart
Future<NewData> fetchNewData() async {
  final uri = Uri.https(_baseUrl, newEndpointPath);
  return await _authorizedGetData<NewData>(
    uri,
    parseData: (data) => NewData.fromJson(data),
  );
}
```
