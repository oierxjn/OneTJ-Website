---
title: 目录结构
date: 2025-01-29 00:00:00
permalink: /guide/structure
categories:
  - 指南
tags:
  - 指南
  - 项目结构
description: 介绍 OneTJ 项目的目录组织结构。
---

## 项目结构概览

OneTJ 采用分层架构组织代码，以下是项目的目录结构：

```
OneTJ/
├── lib/                    # 源代码目录
│   ├── app/               # 应用级配置
│   ├── features/          # 功能模块
│   ├── models/            # 数据模型
│   ├── repo/              # 数据仓库
│   ├── services/          # 服务层
│   ├── l10n/              # 国际化资源
│   └── main.dart          # 应用入口
├── assets/                # 静态资源
├── local_packages/        # 本地插件包
├── test/                  # 测试代码
├── pubspec.yaml           # 项目配置
└── README.md              # 项目说明
```

## lib/ 目录详解

### app/ - 应用级配置

应用级别的常量、异常处理和路由配置。

```
lib/app/
├── constant/              # 常量定义
│   ├── route_paths.dart   # 路由路径常量
│   └── site_constant.dart # API 配置常量
├── exception/             # 异常处理
│   └── app_exception.dart # 自定义异常类
└── router/                # 路由配置
    └── app_router.dart    # 全局路由器
```

#### site_constant.dart

包含 API 相关的配置常量：

```dart
// API 基础 URL
const String tongjiApiBaseUrl = "api.tongji.edu.cn";

// OAuth 配置
const String tongjiClientID = "authorization-xxb-onedottongji-yuchen";
const String oneTJredirectUri = "https://fakeredir.jkljkluiouio.top";

// API 端点
const String loginEndpointPath = "/keycloak/.../auth";
const String code2tokenPath = "/v1/token";
const String studentInfoPath = "/v1/dc/user/student_info";
// ...

// OAuth 权限范围
const List<String> oauthScope = [
  "dc_user_student_info",
  "rt_onetongji_school_calendar_current_term_calendar",
  "rt_onetongji_student_timetable",
  // ...
];
```

### features/ - 功能模块

按照功能划分的模块化代码。

```
lib/features/
├── launcher/              # 启动模块
│   ├── routes.dart        # 路由定义
│   ├── view_models/       # 视图模型
│   └── views/             # 视图组件
├── login/                 # 登录模块
│   ├── routes.dart
│   ├── models/
│   ├── view_models/
│   └── views/
└── home/                  # 主页模块
    ├── routes.dart
    ├── models/
    ├── view_models/
    └── views/
        ├── dashboard_view.dart    # 仪表盘
        ├── timetable_view.dart    # 课程表
        ├── settings_view.dart     # 设置
        └── home_view.dart         # 主页容器
```

### models/ - 数据模型

全局共享的数据模型。

```
lib/models/
├── api_response.dart      # API 响应包装类
├── base_model.dart        # 基础视图模型
├── event_model.dart       # 事件模型
├── timetable_index.dart   # 课程表索引
└── data/                  # API 数据模型
    ├── code2token.dart              # 令牌数据
    ├── course_schedule_net_data.dart # 课程表数据
    ├── school_calendar_net_data.dart # 校历数据
    └── student_info_net_data.dart    # 学生信息数据
```

### repo/ - 数据仓库

管理本地缓存和数据获取。

```
lib/repo/
├── token_repository.dart           # 令牌管理
├── student_info_repository.dart    # 学生信息缓存
├── school_calendar_repository.dart # 校历缓存
└── course_schedule_repository.dart # 课程表缓存
```

### services/ - 服务层

API 服务和业务逻辑。

```
lib/services/
├── tongji.dart              # 同济 API 服务
└── timetable_index_builder.dart  # 课程表索引构建器
```

## assets/ - 静态资源

```
assets/
├── icon/
│   └── logo.jpg            # 应用图标
└── pictures/
    └── 1.jpg               # 图片资源
```

## local_packages/ - 本地插件

存放需要特殊处理的 Flutter 插件。

```
local_packages/
└── flutter_inappwebview/   # WebView 插件（鸿魔版）
    ├── flutter_inappwebview/
    ├── flutter_inappwebview_platform_interface/
    ├── flutter_inappwebview_android/
    ├── flutter_inappwebview_ios/
    ├── flutter_inappwebview_macos/
    ├── flutter_inappwebview_web/
    ├── flutter_inappwebview_ohos/
    └── flutter_inappwebview_windows/
```

## 模块间依赖关系

```
┌─────────────────────────────────────────────┐
│                  Features                    │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐    │
│  │ Launcher │→│  Login  │→│  Home   │    │
│  └─────────┘  └─────────┘  └─────────┘    │
└───────────────────┬─────────────────────────┘
                    │
                    ↓
┌─────────────────────────────────────────────┐
│              Services / Repo                 │
│  ┌────────────┐  ┌──────────────────────┐  │
│  │ TongjiApi  │←→│ Repositories (Hive)  │  │
│  └────────────┘  └──────────────────────┘  │
└───────────────────┬─────────────────────────┘
                    │
                    ↓
┌─────────────────────────────────────────────┐
│                  Models                      │
│  Data Models, Base Models, Event Models     │
└─────────────────────────────────────────────┘
```

## 文件命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| **Dart 文件** | 小写下划线分隔 | `login_view_model.dart` |
| **类名** | 大驼峰 | `LoginViewModel` |
| **私有类** | 下划线前缀 | `_PrivateClass` |
| **常量** | 大写下划线 | `API_BASE_URL` |
| **私有成员** | 下划线前缀 | `_privateField` |
